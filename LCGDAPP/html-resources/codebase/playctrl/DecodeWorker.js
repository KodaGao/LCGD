(function(e){const r=0,l=1,a=2,u=100,t=101,o=1,n=31,d=16;importScripts("Decoder.js"),Module.postRun.push((function(){postMessage({function:"loaded"})}));var s=0,f=!1,i=!1,M=null;function c(e){var r=e.year,l=e.month,a=e.day,u=e.hour,t=e.minute,o=e.second;return l<10&&(l="0"+l),a<10&&(a="0"+a),u<10&&(u="0"+u),t<10&&(t="0"+t),o<10&&(o="0"+o),r+"-"+l+"-"+a+" "+u+":"+t+":"+o}function m(e){var s=e();if(s!==o)return n!==s&&d!==s||postMessage({function:"GetFrameData",type:"",data:null,dataLen:-1,osd:0,frameInfo:null,errorCode:s}),s;var f=Module._GetFrameInfo();switch(f.frameType){case r:var i=f.frameSize;if(0===i)return-1;var M=Module._GetFrameBuffer(),m=new Uint8Array(i);return m.set(Module.HEAPU8.subarray(M,M+i)),postMessage({function:"GetFrameData",type:"audioType",data:m.buffer,frameInfo:f,errorCode:s},[m.buffer]),f=null,M=null,audioBuf=null,m=null,u;case l:var p=c(f),_=f.width,y=f.height,v=_*y*3/2;if(0===v)return-1;var b=Module._GetFrameBuffer(),g=new Uint8Array(v);return g.set(Module.HEAPU8.subarray(b,b+v)),postMessage({function:"GetFrameData",type:"videoType",data:g.buffer,dataLen:g.length,osd:p,frameInfo:f,errorCode:s},[g.buffer]),f=null,b=null,buf=null,g=null,t;case a:return postMessage({function:"GetFrameData",type:"",data:null,dataLen:-1,osd:0,frameInfo:null,errorCode:d}),d;default:return postMessage({function:"GetFrameData",type:"",data:null,dataLen:-1,osd:0,frameInfo:null,errorCode:d}),d}}function p(e){for(var r,l,a=[],u=0;u<e.length;u++){r=e.charCodeAt(u),l=[];do{l.push(255&r),r>>=8}while(r);a=a.concat(l.reverse())}return a}onmessage=function(e){var r=e.data,l=0;switch(r.command){case"SetStreamOpenMode":if(s=r.data,l=Module._SetStreamOpenMode(s),l!==o)return void postMessage({function:"SetStreamOpenMode",errorCode:l});f=!0;break;case"OpenStream":var a=r.dataSize,u=Module._malloc(a+4);if(null===u)return;var d=Module.HEAPU8.subarray(u,u+a);if(d.set(r.data),l=Module._OpenStream(u,a,r.bufPoolSize),postMessage({function:"OpenStream",errorCode:l}),l!==o)return Module._free(u),void(u=null);i=!0;var c=new Uint32Array([a]),_=new Uint8Array(c.buffer),y=new Uint8Array(a+4);if(y.set(_,0),y.set(r.data,4),c=null,_=null,d=Module.HEAPU8.subarray(u,u+a+4),d.set(y),y=null,l=Module._InputData(u,a+4),l!==o)return postMessage({function:"InputData",errorCode:l}),Module._free(u),void(u=null);Module._free(u),u=null,null===M&&(M=Module.cwrap("GetFrameData","number")),0===s&&M();break;case"InputData":var v=r.dataSize;if(v>0){var b=Module._malloc(v);if(null===b)return;var g=new Uint8Array(r.data);Module.writeArrayToMemory(g,b),g=null,l=Module._InputData(b,v),l!==o&&(98===l&&(l=1),postMessage({function:"InputData",errorCode:l})),Module._free(b),pData=null}null===M&&(M=Module.cwrap("GetFrameData","number"));while(f&&i){var S=m(M);if(t===S||n===S)break}break;case"SetSecretKey":var h=r.nKeyLen,D=Module._malloc(h);if(null===D)return;var w=r.data.length,A=p(r.data),G=Module.HEAPU8.subarray(D,D+h);if(G.set(new Uint8Array(A)),l=Module._SetSecretKey(r.nKeyType,D,h,w),l!==o)return postMessage({function:"SetSecretKey",errorCode:l}),Module._free(D),void(D=null);Module._free(D),D=null;break;case"GetBMP":var C=r.width,U=r.height,P=r.data,F=C*U*3/2,I=r.rect,k=Module._malloc(F);if(null===k)return;Module.writeArrayToMemory(new Uint8Array(P,0,F),k);var E=C*U*4+60,T=Module._malloc(E),B=Module._malloc(4);if(null===T||null===B)return Module._free(k),k=null,null!=T&&(Module._free(T),T=null),void(null!=B&&(Module._free(B),B=null));if(Module._memset(B,E,4),l=Module._GetBMP(k,F,T,B,I.left,I.top,I.right,I.bottom),l!==o)return postMessage({function:"GetBMP",errorCode:l}),Module._free(k),k=null,Module._free(T),T=null,Module._free(B),void(B=null);var H=Module.getValue(B,"i32"),O=new Uint8Array(H);O.set(Module.HEAPU8.subarray(T,T+H)),postMessage({function:"GetBMP",data:O,errorCode:l},[O.buffer]),null!=k&&(Module._free(k),k=null),null!=T&&(Module._free(T),T=null),null!=B&&(Module._free(B),B=null);break;case"GetJPEG":var R=r.width,z=r.height,K=r.data,L=R*z*3/2,J=r.rect,V=Module._malloc(L);if(null===V)return;Module.writeArrayToMemory(new Uint8Array(K,0,L),V);var j=Module._malloc(L),N=Module._malloc(4);if(null===j||null===N)return null!=j&&(Module._free(j),j=null),null!=N&&(Module._free(N),N=null),void(null!=V&&(Module._free(V),V=null));if(Module.setValue(N,R*z*2,"i32"),l=Module._GetJPEG(V,L,j,N,J.left,J.top,J.right,J.bottom),l!==o)return postMessage({function:"GetJPEG",errorCode:l}),null!=j&&(Module._free(j),j=null),null!=N&&(Module._free(N),N=null),void(null!=V&&(Module._free(V),V=null));var W=Module.getValue(N,"i32"),q=new Uint8Array(W);q.set(Module.HEAPU8.subarray(j,j+W)),postMessage({function:"GetJPEG",data:q,errorCode:l},[q.buffer]),ajpegSizeData=null,q=null,null!=V&&(Module._free(V),V=null),null!=j&&(Module._free(j),j=null),null!=N&&(Module._free(N),N=null);break;case"SetDecodeFrameType":var x=r.data;if(l=Module._SetDecodeFrameType(x),l!==o)return void postMessage({function:"SetDecodeFrameType",errorCode:l});break;case"DisplayRegion":var Q=r.nRegionNum,X=r.srcRect,Y=r.hDestWnd,Z=r.bEnable;if(l=Module._SetDisplayRegion(Q,X,Y,Z),l!==o)return void postMessage({function:"DisplayRegion",errorCode:l});break;case"CloseStream":if(l=Module._CloseStream(),l!==o)return void postMessage({function:"CloseStream",errorCode:l});break;case"SetIFrameDecInterval":Module._SetIFrameDecInterval(r.data);break;default:break}}})();