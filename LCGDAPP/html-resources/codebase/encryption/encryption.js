define((function(e,t,n){var c,o,r;function i(){}e("websdk"),c=e("common"),o=e("utils"),r=e("base64"),i.prototype.encrypt=function(e,t,n,i){var a=1024;t&&(a=t);var p=new Date+"",y=cryptico.generateRSAKey(p,a),l=cryptico.publicKeyString(y),s="<?xml version='1.0' encoding='UTF-8'?><PublicKey><key>"+r.encode(l)+"</key></PublicKey>",d=o.parseXmlFromStr(s);WebSDK.WSDK_Request(c.m_szHostName,c.m_iHttpProtocal,c.m_iHttpPort,{cmd:"challenge",type:"POST",data:d,success:function(t,c){var p=cryptico.decrypt(r.decode(o.nodeValue(c,"key")),y);if(null!=p.plaintext){var l,s,d=[];if(l=256===a?o.toHex(p.plaintext):p.plaintext,s=aes_encrypt(p.plaintext.substring(0,16),l,!0),"function"===typeof i)if("string"===typeof e)n&&(e=r.encode(e)),i(r.encode(s+o.encodeAES(e,l,"","ecb")));else if("[object Array]"===Object.prototype.toString.call(e)){for(var u=0,f=e.length;u<f;u++){n&&(e[u]=r.encode(e[u]));var b=s+o.encodeAES(e[u],l,"","ecb");d.push(r.encode(b))}i(d)}}}})},i.prototype.encryptSync=function(e,t,n){var i=1024,a=[];t&&(i=t);var p=new Date+"",y=cryptico.generateRSAKey(p,i),l=cryptico.publicKeyString(y),s="<?xml version='1.0' encoding='UTF-8'?><PublicKey><key>"+r.encode(l)+"</key></PublicKey>",d=o.parseXmlFromStr(s);return WebSDK.WSDK_Request(c.m_szHostName,c.m_iHttpProtocal,c.m_iHttpPort,{cmd:"challenge",type:"POST",async:!1,data:d,success:function(t,c){var p,l,s=cryptico.decrypt(r.decode(o.nodeValue(c,"key")),y);if(null!=s.plaintext)if(p=256===i?o.toHex(s.plaintext):s.plaintext,l=aes_encrypt(s.plaintext.substring(0,16),p,!0),"string"===typeof e)n&&(e=r.encode(e)),a.push(r.encode(l+o.encodeAES(e,p,"","ecb")));else for(var d=0,u=e.length;d<u;d++){n&&(e[d]=r.encode(e[d]));var f=l+o.encodeAES(e[d],p,"","ecb");a.push(r.encode(f))}}}),"string"===typeof e?a[0]:a},n.exports=new i}));